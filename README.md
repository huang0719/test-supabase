# Supabase + Vue3 æƒé™ç®¡ç†ç³»ç»Ÿ

ä¸€ä¸ªåŸºäº Supabaseã€Vue3ã€TypeScriptã€Element Plus çš„æƒé™ç®¡ç†ç³»ç»Ÿï¼Œé‡‡ç”¨ RBAC æƒé™æ§åˆ¶æ¨¡å‹ã€‚

## âœ¨ ç‰¹æ€§

- ğŸš€ é‡‡ç”¨æœ€æ–°æŠ€æœ¯æ ˆï¼šVue3 + TypeScript + Vite + Pinia
- ğŸ¨ UI ç»„ä»¶åº“ï¼šElement Plus
- ğŸ” å®Œæ•´çš„æƒé™ç³»ç»Ÿï¼šåŸºäº RBAC çš„æƒé™æ§åˆ¶
- ğŸŒ Supabase åç«¯ï¼šæ— éœ€è‡ªå»ºåç«¯æœåŠ¡
- ğŸ“± å“åº”å¼è®¾è®¡ï¼šæ”¯æŒæ¡Œé¢å’Œç§»åŠ¨ç«¯
- ğŸ¯ è·¯ç”±æƒé™ï¼šåŠ¨æ€è·¯ç”± + è·¯ç”±å®ˆå«
- ğŸ”§ æŒ‰é’®æƒé™ï¼šè‡ªå®šä¹‰æŒ‡ä»¤æ§åˆ¶æŒ‰é’®æ˜¾ç¤º
- ğŸ“Š æ•°æ®æƒé™ï¼šé€šè¿‡ RLS ç­–ç•¥å®ç°æ•°æ®çº§æƒé™

## ğŸ“¦ æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: Vue 3.5+ (Composition API)
- **è¯­è¨€**: TypeScript 5.9+
- **æ„å»ºå·¥å…·**: Vite 7.1+
- **çŠ¶æ€ç®¡ç†**: Pinia 3.0+
- **è·¯ç”±**: Vue Router 4.5+
- **UI ç»„ä»¶**: Element Plus 2.5+
- **å›¾æ ‡**: @element-plus/icons-vue
- **åç«¯æœåŠ¡**: Supabase
- **CSS é¢„å¤„ç†**: Sass

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿ä½ çš„å¼€å‘ç¯å¢ƒæ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š

- Node.js >= 20.19.0
- pnpm >= 8.0.0 (æ¨è) æˆ– npm >= 9.0.0

### 2. å…‹éš†é¡¹ç›®

```bash
git clone <your-repo-url>
cd supabase-admin
```

### 3. å®‰è£…ä¾èµ–

```bash
pnpm install
# æˆ–
npm install
```

### 4. é…ç½® Supabase

#### 4.1 åˆ›å»º Supabase é¡¹ç›®

1. è®¿é—® [https://supabase.com](https://supabase.com)
2. åˆ›å»ºæ–°é¡¹ç›®
3. è®°å½•ä»¥ä¸‹ä¿¡æ¯ï¼š
   - Project URL: `https://your-project.supabase.co`
   - anon/public API Key: `your-anon-key`

#### 4.2 æ‰§è¡Œ SQL è„šæœ¬

åœ¨ Supabase SQL Editor ä¸­æ‰§è¡Œ `database.sql` æ–‡ä»¶ä¸­çš„ SQL è„šæœ¬ï¼Œåˆ›å»ºæ•°æ®è¡¨å’Œ RLS ç­–ç•¥ã€‚

#### 4.3 é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ `.env.example` ä¸º `.env` å¹¶å¡«å…¥ä½ çš„ Supabase é…ç½®ï¼š

```env
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key
VITE_APP_TITLE=æƒé™ç®¡ç†ç³»ç»Ÿ
```

### 5. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
pnpm dev
# æˆ–
npm run dev
```

æµè§ˆå™¨è‡ªåŠ¨æ‰“å¼€ `http://localhost:3000`

### 6. åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·

#### æ–¹å¼ä¸€ï¼šé€šè¿‡ Supabase Dashboard

1. åœ¨ Supabase Dashboard çš„ Authentication é¡µé¢åˆ›å»ºç”¨æˆ·
2. è®°å½•ç”¨æˆ· UUID
3. åœ¨ SQL Editor ä¸­æ‰§è¡Œï¼š

```sql
-- å°†ç”¨æˆ·å…³è”åˆ°è¶…çº§ç®¡ç†å‘˜è§’è‰²
INSERT INTO sys_user_role (user_id, role_id) 
VALUES ('your-user-uuid', 1);

-- æ›´æ–°ç”¨æˆ·ä¿¡æ¯
UPDATE sys_user 
SET user_name = 'admin', 
    nick_name = 'è¶…çº§ç®¡ç†å‘˜',
    status = '0'
WHERE id = 'your-user-uuid';
```

#### æ–¹å¼äºŒï¼šé€šè¿‡ä»£ç æ³¨å†Œ

ç™»å½•é¡µé¢æä¾›äº†æ³¨å†ŒåŠŸèƒ½ï¼ˆéœ€è¦å…ˆå®ç°æ³¨å†Œé¡µé¢ï¼‰ã€‚

### 7. ç™»å½•ç³»ç»Ÿ

ä½¿ç”¨åˆ›å»ºçš„ç®¡ç†å‘˜è´¦æˆ·ç™»å½•ç³»ç»Ÿã€‚

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
supabase-admin/
â”œâ”€â”€ public/                  # é™æ€èµ„æº
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ assets/             # èµ„æºæ–‡ä»¶ï¼ˆå›¾ç‰‡ã€æ ·å¼ç­‰ï¼‰
â”‚   â”œâ”€â”€ components/         # å…¬å…±ç»„ä»¶
â”‚   â”œâ”€â”€ composables/        # ç»„åˆå¼å‡½æ•°
â”‚   â”‚   â””â”€â”€ usePermission.ts # æƒé™æ£€æŸ¥
â”‚   â”œâ”€â”€ directives/         # è‡ªå®šä¹‰æŒ‡ä»¤
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ permission.ts   # æƒé™æŒ‡ä»¤
â”‚   â”œâ”€â”€ layout/             # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ AppMain.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ Navbar.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.vue
â”‚   â”‚   â”‚   â””â”€â”€ SidebarItem.vue
â”‚   â”‚   â””â”€â”€ index.vue
â”‚   â”œâ”€â”€ router/             # è·¯ç”±é…ç½®
â”‚   â”‚   â”œâ”€â”€ index.ts        # è·¯ç”±å®šä¹‰
â”‚   â”‚   â””â”€â”€ permission.ts   # è·¯ç”±å®ˆå«
â”‚   â”œâ”€â”€ stores/             # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ app.ts          # åº”ç”¨çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ menu.ts         # èœå•çŠ¶æ€
â”‚   â”‚   â””â”€â”€ user.ts         # ç”¨æˆ·çŠ¶æ€
â”‚   â”œâ”€â”€ types/              # ç±»å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ request.ts      # HTTP è¯·æ±‚
â”‚   â”‚   â””â”€â”€ supabase.ts     # Supabase å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ views/              # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ system/         # ç³»ç»Ÿç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ user/       # ç”¨æˆ·ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ role/       # è§’è‰²ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ menu/       # èœå•ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ dept/       # éƒ¨é—¨ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ error/
â”‚   â”‚   â”‚   â””â”€â”€ 404.vue
â”‚   â”‚   â”œâ”€â”€ Dashboard.vue   # ä»ªè¡¨ç›˜
â”‚   â”‚   â””â”€â”€ Login.vue       # ç™»å½•é¡µ
â”‚   â”œâ”€â”€ App.vue
â”‚   â””â”€â”€ main.ts
â”œâ”€â”€ .env                    # ç¯å¢ƒå˜é‡
â”œâ”€â”€ .env.example            # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ database.sql            # æ•°æ®åº“è„šæœ¬
â”œâ”€â”€ index.html
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ vite.config.ts
â””â”€â”€ README.md
```

## ğŸ” æƒé™ç³»ç»Ÿ

### RBAC æ¨¡å‹

```
ç”¨æˆ·(User) â”€â”€â”¬â”€â”€> è§’è‰²(Role) â”€â”€> èœå•æƒé™(Menu)
            â”‚
            â””â”€â”€> éƒ¨é—¨(Dept) â”€â”€> æ•°æ®æƒé™
```

### æƒé™ä½¿ç”¨

#### 1. æŒ‡ä»¤æ–¹å¼

```vue
<template>
  <!-- æŒ‰é’®æƒé™ -->
  <el-button v-permission="['system:user:add']">æ–°å¢</el-button>
  
  <!-- è§’è‰²æƒé™ -->
  <div v-role="['admin']">ç®¡ç†å‘˜å¯è§å†…å®¹</div>
</template>
```

#### 2. ç¼–ç¨‹æ–¹å¼

```vue
<script setup lang="ts">
import { usePermission } from '@/composables/usePermission'

const { hasPermission, hasRole, isAdmin } = usePermission()

// æ£€æŸ¥æƒé™
if (hasPermission('system:user:edit')) {
  // æ‰§è¡Œæ“ä½œ
}

// æ£€æŸ¥è§’è‰²
if (hasRole('admin')) {
  // æ‰§è¡Œæ“ä½œ
}

// æ˜¯å¦æ˜¯ç®¡ç†å‘˜
if (isAdmin.value) {
  // æ‰§è¡Œæ“ä½œ
}
</script>
```

#### 3. è·¯ç”±æƒé™

```typescript
{
  path: '/system/user',
  component: () => import('@/views/system/user/index.vue'),
  meta: {
    title: 'ç”¨æˆ·ç®¡ç†',
    permissions: ['system:user:list'] // éœ€è¦çš„æƒé™
  }
}
```

### æ•°æ®æƒé™èŒƒå›´

- `1` - å…¨éƒ¨æ•°æ®æƒé™
- `2` - è‡ªå®šä¹‰æ•°æ®æƒé™
- `3` - æœ¬éƒ¨é—¨æ•°æ®æƒé™
- `4` - æœ¬éƒ¨é—¨åŠä»¥ä¸‹æ•°æ®æƒé™
- `5` - ä»…æœ¬äººæ•°æ®æƒé™

## ğŸ“ æ ¸å¿ƒåŠŸèƒ½

### ç³»ç»Ÿç®¡ç†

- âœ… ç”¨æˆ·ç®¡ç†ï¼šç”¨æˆ·çš„å¢åˆ æ”¹æŸ¥ã€çŠ¶æ€ç®¡ç†
- âœ… è§’è‰²ç®¡ç†ï¼šè§’è‰²çš„å¢åˆ æ”¹æŸ¥ã€æƒé™åˆ†é…
- âœ… èœå•ç®¡ç†ï¼šèœå•çš„å¢åˆ æ”¹æŸ¥ã€æ ‘å½¢å±•ç¤º
- âœ… éƒ¨é—¨ç®¡ç†ï¼šéƒ¨é—¨çš„å¢åˆ æ”¹æŸ¥ã€æ ‘å½¢å±•ç¤º

### åŠŸèƒ½ç‰¹æ€§

- âœ… ç”¨æˆ·ç™»å½•/ç™»å‡º
- âœ… æƒé™éªŒè¯ï¼ˆè·¯ç”±çº§ã€æŒ‰é’®çº§ï¼‰
- âœ… åŠ¨æ€è·¯ç”±
- âœ… é¢åŒ…å±‘å¯¼èˆª
- âœ… ä¾§è¾¹æ æŠ˜å 
- âœ… å“åº”å¼å¸ƒå±€

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°é¡µé¢

1. åœ¨ `src/views` ä¸‹åˆ›å»ºé¡µé¢ç»„ä»¶
2. åœ¨ `src/router/index.ts` ä¸­æ·»åŠ è·¯ç”±
3. åœ¨æ•°æ®åº“ä¸­æ·»åŠ ç›¸åº”çš„èœå•æƒé™

### æ·»åŠ æ–°æƒé™

1. åœ¨æ•°æ®åº“ `sys_menu` è¡¨ä¸­æ·»åŠ æƒé™æ ‡è¯†
2. å°†æƒé™åˆ†é…ç»™ç›¸åº”çš„è§’è‰²
3. åœ¨é¡µé¢ä¸­ä½¿ç”¨ `v-permission` æŒ‡ä»¤æˆ– `hasPermission` å‡½æ•°

### æ ·å¼å¼€å‘

é¡¹ç›®ä½¿ç”¨ Sass ä½œä¸º CSS é¢„å¤„ç†å™¨ï¼Œæ”¯æŒåµŒå¥—ã€å˜é‡ç­‰ç‰¹æ€§ã€‚

## ğŸ“¦ æ„å»ºéƒ¨ç½²

### æ„å»ºç”Ÿäº§ç‰ˆæœ¬

```bash
pnpm build
# æˆ–
npm run build
```

æ„å»ºäº§ç‰©åœ¨ `dist` ç›®å½•ä¸‹ã€‚

### é¢„è§ˆç”Ÿäº§ç‰ˆæœ¬

```bash
pnpm preview
# æˆ–
npm run preview
```

### éƒ¨ç½²

å°† `dist` ç›®å½•éƒ¨ç½²åˆ°ä»»ä½•é™æ€æ–‡ä»¶æœåŠ¡å™¨å³å¯ï¼Œå¦‚ï¼š

- Vercel
- Netlify
- GitHub Pages
- é˜¿é‡Œäº‘ OSS
- è…¾è®¯äº‘ COS

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **RLS ç­–ç•¥**ï¼šç¡®ä¿æ‰€æœ‰è¡¨éƒ½å¯ç”¨äº† RLSï¼Œå¦åˆ™æ•°æ®å¯èƒ½æ³„éœ²
2. **æƒé™ç¼“å­˜**ï¼šç”¨æˆ·æƒé™å˜æ›´åéœ€è¦é‡æ–°ç™»å½•
3. **è¶…çº§ç®¡ç†å‘˜**ï¼š`role_key='admin'` çš„è§’è‰²æ‹¥æœ‰æ‰€æœ‰æƒé™
4. **å¯†ç å¼ºåº¦**ï¼šSupabase Auth é»˜è®¤è¦æ±‚è‡³å°‘ 6 ä½å¯†ç 
5. **é‚®ç®±éªŒè¯**ï¼šç”Ÿäº§ç¯å¢ƒå»ºè®®å¯ç”¨é‚®ç®±éªŒè¯

## ğŸ”— ç›¸å…³é“¾æ¥

- [Vue 3 æ–‡æ¡£](https://cn.vuejs.org/)
- [Vite æ–‡æ¡£](https://cn.vitejs.dev/)
- [Element Plus æ–‡æ¡£](https://element-plus.org/)
- [Supabase æ–‡æ¡£](https://supabase.com/docs)
- [Pinia æ–‡æ¡£](https://pinia.vuejs.org/zh/)

## ğŸ“„ License

[MIT](LICENSE)

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æäº¤ Issueã€‚
